



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
        <meta name="author" content="Don Stewart">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../images/logos/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.4">
    
    
      
        <title>Usage - Porter-Kustomize</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#03a9f4">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="../css/pdf_output.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="light-blue" data-md-color-accent="light-blue">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../#example-porter-kustomize-implementations" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Porter-Kustomize" class="md-header-nav__button md-logo">
          
            <img src="https://porter.sh/images/porter-logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Porter-Kustomize
              </span>
              <span class="md-header-nav__topic">
                Usage
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/donmstewart/porter-kustomize.git/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Porter-Kustomize" class="md-nav__button md-logo">
      
        <img src="https://porter.sh/images/porter-logo.png" width="48" height="48">
      
    </a>
    Porter-Kustomize
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/donmstewart/porter-kustomize.git/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../development/" title="Building the Mixin" class="md-nav__link">
      Building the Mixin
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Usage
      </label>
    
    <a href="./" title="Usage" class="md-nav__link md-nav__link--active">
      Usage
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deployment-of-a-complex-cnab-bundle" title="Deployment of a Complex CNAB Bundle" class="md-nav__link">
    Deployment of a Complex CNAB Bundle
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#porteryaml" title="porter.yaml" class="md-nav__link">
    porter.yaml
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cnab-bundle-manifest" title="CNAB Bundle Manifest" class="md-nav__link">
    CNAB Bundle Manifest
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mixins" title="mixins:" class="md-nav__link">
    mixins:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#credentials" title="credentials:" class="md-nav__link">
    credentials:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters" title="parameters:" class="md-nav__link">
    parameters:
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gh_token" title="gh_token" class="md-nav__link">
    gh_token
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment" title="environment" class="md-nav__link">
    environment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-kustomize" title="install: - kustomize" class="md-nav__link">
    install: - kustomize
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-kubernetes" title="install: - kubernetes" class="md-nav__link">
    install: - kubernetes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../about/" title="About" class="md-nav__link">
      About
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deployment-of-a-complex-cnab-bundle" title="Deployment of a Complex CNAB Bundle" class="md-nav__link">
    Deployment of a Complex CNAB Bundle
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#porteryaml" title="porter.yaml" class="md-nav__link">
    porter.yaml
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cnab-bundle-manifest" title="CNAB Bundle Manifest" class="md-nav__link">
    CNAB Bundle Manifest
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mixins" title="mixins:" class="md-nav__link">
    mixins:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#credentials" title="credentials:" class="md-nav__link">
    credentials:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters" title="parameters:" class="md-nav__link">
    parameters:
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gh_token" title="gh_token" class="md-nav__link">
    gh_token
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment" title="environment" class="md-nav__link">
    environment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-kustomize" title="install: - kustomize" class="md-nav__link">
    install: - kustomize
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-kubernetes" title="install: - kubernetes" class="md-nav__link">
    install: - kubernetes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/donmstewart/porter-kustomize.git/edit/master/docs/examples.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="example-porter-kustomize-implementations">Example Porter-Kustomize Implementations<a class="headerlink" href="#example-porter-kustomize-implementations" title="Permanent link">&para;</a></h1>
<h2 id="deployment-of-a-complex-cnab-bundle">Deployment of a Complex CNAB Bundle<a class="headerlink" href="#deployment-of-a-complex-cnab-bundle" title="Permanent link">&para;</a></h2>
<p>If we look at a complex, but real world relevant scenario, to deploy an application made up of
multiple (12) micro-services which simulates an end-to-end solution from Web UI, Shopping Cart, Catalogue,
Databases etc.</p>
<p><img alt="App Architecture" src="../images/example/microservice-app-high-level.png" /></p>
<p>The <code>porter.yaml</code> is below. Yoiu will notice the different sections i.e. <code>install</code>, <code>upgrade</code> and <code>uninstall</code> all
look identical. This is because the <code>porter-kustomize</code> mixin is in fact executing exactly the same functionality.</p>
<p>As kustomize is simply responsible for generating the kubernetes manifests the actual different behaviour e.g.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">kubectl apply -f</span>
</pre></div>
</td></tr></table>

<p>vs.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">kubectl delete -f</span>
</pre></div>
</td></tr></table>

<p>is handled by the standard built-in mixin for kubernetes. The generation of the manifests by <code>porter-kustomize</code> for 
kuberntes to use is in fact identical. </p>
<h3 id="porteryaml"><code>porter.yaml</code><a class="headerlink" href="#porteryaml" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># This is the configuration for Porter</span>
<span class="c1"># You must define steps for each action, but the rest is optional</span>
<span class="c1"># See https://porter.sh/authoring-bundles for documentation on how to configure your bundle</span>
<span class="c1"># Uncomment out the sections below to take full advantage of what Porter can do!</span>

<span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Robotshop</span>
<span class="l l-Scalar l-Scalar-Plain">version</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0.3.2</span>
<span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="s">&quot;Stans</span><span class="nv"> </span><span class="s">Robotshop</span><span class="nv"> </span><span class="s">Application&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">invocationImage</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">porter-robotshop:latest</span>
<span class="l l-Scalar l-Scalar-Plain">tag</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">dockerps/porter-robotshop-bundle:latest</span>

<span class="c1"># Uncomment out the line below to use a template Dockerfile for your invocation image</span>
<span class="c1">#dockerfile: Dockerfile.tmpl</span>

<span class="l l-Scalar l-Scalar-Plain">mixins</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">exec</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">kustomize</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes</span>

<span class="c1"># See https://porter.sh/wiring/#credentials</span>
<span class="l l-Scalar l-Scalar-Plain">credentials</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">kubeconfig</span>
    <span class="l l-Scalar l-Scalar-Plain">path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/root/.kube/config</span>

<span class="l l-Scalar l-Scalar-Plain">parameters</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">gh_token</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">environment</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
    <span class="l l-Scalar l-Scalar-Plain">default</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">local</span>

<span class="l l-Scalar l-Scalar-Plain">install</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">kustomize</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="s">&quot;Installing:</span><span class="nv"> </span><span class="s">Use</span><span class="nv"> </span><span class="s">Kustomize</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">generate</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Kubernetes</span><span class="nv"> </span><span class="s">deployment</span><span class="nv"> </span><span class="s">file</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">Stan&#39;s</span><span class="nv"> </span><span class="s">Robotshop&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">porter-robotshop-install</span>
      <span class="l l-Scalar l-Scalar-Plain">kustomization_input</span><span class="p p-Indicator">:</span> 
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/cart&quot;</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/catalogue&quot;</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/dispatch&quot;</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/mongodb&quot;</span> 
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/mysql&quot;</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/payment&quot;</span> 
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/rabbitmq&quot;</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/ratings&quot;</span>   
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/redis&quot;</span>     
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/shipping&quot;</span>    
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/user&quot;</span>   
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/web&quot;</span>            
      <span class="l l-Scalar l-Scalar-Plain">kubernetes_manifest_output</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">manifests/</span>
      <span class="l l-Scalar l-Scalar-Plain">set</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">kustomizeBaseGHToken</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">bundle.parameters.gh_token</span><span class="nv"> </span><span class="s">}}&quot;</span>

  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="s">&quot;Perform</span><span class="nv"> </span><span class="s">Robotshop</span><span class="nv"> </span><span class="s">Deployment&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">manifests</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">manifests/</span>
      <span class="l l-Scalar l-Scalar-Plain">wait</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="l l-Scalar l-Scalar-Plain">upgrade</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">kustomize</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="s">&quot;Upgrading:</span><span class="nv"> </span><span class="s">Use</span><span class="nv"> </span><span class="s">Kustomize</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">generate</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Kubernetes</span><span class="nv"> </span><span class="s">deployment</span><span class="nv"> </span><span class="s">file</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">Stan&#39;s</span><span class="nv"> </span><span class="s">Robotshop&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">porter-robotshop-upgrade</span>
      <span class="l l-Scalar l-Scalar-Plain">kustomization_input</span><span class="p p-Indicator">:</span> 
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/cart&quot;</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/catalogue&quot;</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/dispatch&quot;</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/mongodb&quot;</span> 
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/mysql&quot;</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/payment&quot;</span> 
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/rabbitmq&quot;</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/ratings&quot;</span>   
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/redis&quot;</span>     
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/shipping&quot;</span>    
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/user&quot;</span>   
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/web&quot;</span>            
      <span class="l l-Scalar l-Scalar-Plain">kubernetes_manifest_output</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">manifests/</span>
      <span class="l l-Scalar l-Scalar-Plain">set</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">kustomizeBaseGHToken</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">bundle.parameters.gh_token</span><span class="nv"> </span><span class="s">}}&quot;</span>

  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="s">&quot;Perform</span><span class="nv"> </span><span class="s">Robotshop</span><span class="nv"> </span><span class="s">Upgrade&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">manifests</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">manifests/</span>
      <span class="l l-Scalar l-Scalar-Plain">wait</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="l l-Scalar l-Scalar-Plain">uninstall</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">kustomize</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="s">&quot;Unnstalling:</span><span class="nv"> </span><span class="s">Use</span><span class="nv"> </span><span class="s">Kustomize</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">generate</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Kubernetes</span><span class="nv"> </span><span class="s">deployment</span><span class="nv"> </span><span class="s">file</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">removal&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">porter-robotshop-uninstall</span>
      <span class="l l-Scalar l-Scalar-Plain">kustomization_input</span><span class="p p-Indicator">:</span> 
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/cart&quot;</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/catalogue&quot;</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/dispatch&quot;</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/mongodb&quot;</span> 
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/mysql&quot;</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/payment&quot;</span> 
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/rabbitmq&quot;</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/ratings&quot;</span>   
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/redis&quot;</span>     
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/shipping&quot;</span>    
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/user&quot;</span>   
          <span class="p p-Indicator">-</span> <span class="s">&quot;kustomize/robotshop/overlays/{{</span><span class="nv"> </span><span class="s">bundle.parameters.environment</span><span class="nv"> </span><span class="s">}}/web&quot;</span>            
      <span class="l l-Scalar l-Scalar-Plain">kubernetes_manifest_output</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">manifests/</span>
      <span class="l l-Scalar l-Scalar-Plain">set</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">kustomizeBaseGHToken</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">bundle.parameters.gh_token</span><span class="nv"> </span><span class="s">}}&quot;</span>

  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="s">&quot;Perform</span><span class="nv"> </span><span class="s">Robotshop</span><span class="nv"> </span><span class="s">Undeployment&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">manifests</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">manifests/</span>
      <span class="l l-Scalar l-Scalar-Plain">wait</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>


<span class="c1"># See https://porter.sh/authoring-bundles/#dependencies</span>
<span class="c1">#dependencies:</span>
<span class="c1">#  mysql:</span>
<span class="c1">#    tag: deislabs/porter-mysql:latest</span>
<span class="c1">#    parameters:</span>
<span class="c1">#      database-name: wordpress</span>
</pre></div>
</td></tr></table>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As kustomize allows for different parts of the kubernetes manifest yaml to be defined in different locations i.e.</p>
<ul>
<li>local disk</li>
<li>remote git repository</li>
</ul>
<p>times to generate the kubernetes manifest can vary by a considerable amount i.e. with many micro-services all
pulling base configuration from say GiutHub this introduces quite an overhead timewise. </p>
</div>
<h4 id="cnab-bundle-manifest">CNAB Bundle Manifest<a class="headerlink" href="#cnab-bundle-manifest" title="Permanent link">&para;</a></h4>
<p>The beginning of the <code>porter.yaml</code> defines information for the generated CNAB bundle. 
This is lines 6-10 in the <code>porter.yaml</code> file.</p>
<h4 id="mixins"><code>mixins:</code><a class="headerlink" href="#mixins" title="Permanent link">&para;</a></h4>
<p>This is where we define the <code>mixins</code> to be used as part of the <code>install</code> and <code>uninstall</code> steps in porter. 
The <em><code>mixin-runtime</code></em> binaries will be copied into the docker <code>innvocationImage</code> in order porter can execute the
necessary steps.</p>
<p>This example defines usage of: -</p>
<ul>
<li>exec (not actually used)</li>
<li>kustomize</li>
<li>kubernetes</li>
</ul>
<h4 id="credentials"><code>credentials</code>:<a class="headerlink" href="#credentials" title="Permanent link">&para;</a></h4>
<p>The credentials definition on lines 21-23 is necessary in order that the <code>kubernetes</code> mixin can <code>apply</code> or <code>delete</code> the
specified manifests from the given cluster.</p>
<p>Creation of the credentials is done using the <code>porter credentials generate</code> command from the cli.</p>
<h4 id="parameters"><code>parameters:</code><a class="headerlink" href="#parameters" title="Permanent link">&para;</a></h4>
<p>For this advanced exmaple we have defined two parameters that we need to pass to <code>porter</code> as part of the innvocation.
These parameters are: -</p>
<ul>
<li><code>gh_token</code></li>
<li><code>environment</code></li>
</ul>
<h5 id="gh_token"><code>gh_token</code><a class="headerlink" href="#gh_token" title="Permanent link">&para;</a></h5>
<p><code>gh_token</code> is used as our sample application uses a <code>kustomize</code> feature where base kubernetes manifest
configurations can be defined independantly from the application and leveraged by the application. These base
manifests can be referenced either locally on the filesystem using relative paths or remotely via <code>http/s</code> or point to
a <code>git</code> repository.</p>
<p>For this example the base manifests are referenced in a remote GitHub repository and in order for the
<code>porter-kustomize</code> mixin to access these repos a GitHub token is required to be used when performing a <code>pull</code> request
to download the code.</p>
<p>This can be seen to be defined on lines 26-27 of the <code>porter.yaml</code> and is used on lines 50-51.</p>
<h5 id="environment"><code>environment</code><a class="headerlink" href="#environment" title="Permanent link">&para;</a></h5>
<p><code>environment</code>, the second parameter in our example is used to target which physical environment we are deploying to.
This is passed to the <code>porter-kustomize</code> mixin as the paths to the environment specific configuration contain the name
of the environment e.g. <code>&quot;kustomize/robotshop/overlays/{{ bundle.parameters.environment }}/cart&quot;</code></p>
<p>The <code>environment</code> parameter is defined on lines 28-30 and if it is not passed as a commndline parameter to
porter at innvocation time will default to the <code>local</code> environment, i.e. the current host in our case, and is used on
lines 37-48 of the <code>install</code> step as well as the <code>upgrade</code> and <code>uninstall</code> steps lower down in the <code>porter.yaml</code>.</p>
<h4 id="install-kustomize"><code>install:</code> - <code>kustomize</code><a class="headerlink" href="#install-kustomize" title="Permanent link">&para;</a></h4>
<p>Looking at the specifics of what the <code>install</code> step does we can see the configuration for the <code>porter-kustomize</code> 
mixin starts at line 33. We define a <code>description</code> and <code>name</code> for the step which will be output to the console when 
running the <code>porter install</code> from our commandline (or in out CI/CD tool of choice <code>stdout</code>).</p>
<p>From this example we can see that using the <code>kustomization_input</code> attribute we can pass multiple different 
micro-services to the <code>porter-kustomize</code> mixin which is shown at lines 37 through 48. Each micro-service is in a
separate directory and each is processed sequentially by the mixin.</p>
<p>Line 49 is the <code>kubernetes_manifest_output</code> attribute which tells kustomize where to write out the generated kubernetes
manifest <code>yaml</code> files. </p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code>kubernetes_manifest_output</code> must match what is defined in the subsequent <code>install:</code> for <code>kubernetes</code> 
configuration block <code>manifests</code> section and attributes which in our example are defined at lines 55-56.</p>
</div>
<h4 id="install-kubernetes"><code>install:</code> - <code>kubernetes</code><a class="headerlink" href="#install-kubernetes" title="Permanent link">&para;</a></h4>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../development/" title="Building the Mixin" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Building the Mixin
              </span>
            </div>
          </a>
        
        
          <a href="../about/" title="About" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                About
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.583bbe55.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>